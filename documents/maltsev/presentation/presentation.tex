\documentclass{beamer}
\usepackage[english,russian]{babel}
\usepackage[utf8]{inputenc}

\usepackage{xskak}
\usepackage{chessboard}

\usepackage{mathtools}
\usepackage{mathrsfs}

\usepackage{amsmath,amssymb,cite,graphicx}
\usepackage{subfigure}
\usepackage{url}
\usepackage{wrapfig}

\usepackage{tikz}
\usetikzlibrary{positioning,shapes,shadows,arrows}
%\usetikzlibrary{arrows.meta}
\usetikzlibrary{graphs}

% Стиль презентации
\usetheme{Frankfurt}
\begin{document}
\title{Эвристический метод поиска неподвижной точки в детерминированной игре с полной информацией} 
\author{Афанасьева А.Е., Афонин С.А.}
%\institute{Московский государственный университет имени М.",В.",Ломоносова}
\institute{Московский государственный университет имени М.",В.",Ломоносова\\
  \vspace{2cm}
}
\date{Москва, 2016} 
% Создание заглавной страницы
\frame{\titlepage} 

% Автоматическая генерация содержания
\frame{\frametitle{Содержание}\tableofcontents}

% Вывести диаграмму с отмеченным ходом
%
\newcommand{\showDiagram}[2]{%
      \chessboard[%
      setpieces={#1},%
      arrow=stealth,%
      linewidth=.25ex,%
      padding=1ex,%
      color=red!55!white,%
      pgfstyle=straightmove,%
      shortenstart=1ex,%
      showmover=false,%
      markmoves={#2},%
      padding=10ex,%
      shortenend=1ex%
      ]%
}


\section{Стратегии в играх с полной информацией}
%{Зачем этим нужно заниматься?}
%\subsection{Введение}
\begin{frame}{Области применения}
Теоретико-игровые модели широко используются для описания различных
практических задач: %в области экономики:
\begin{itemize}
\item планирование, составление расписаний;
\item моделирование военных действий;
\item различные экономические задачи  ??;
\item моделирование принятия решений в психологии.
\end{itemize}
\end{frame}

\begin{frame}{Игры с полной информацией}
Под \emph{играми с полной информацией} понимаются такие игры, в которых каждый из игроков обладает информацией, доступной для принятия решения другими игроками.
 
\bigskip
Доказано существование оптимальной стратегии каждого участника игры для детерминированных игр с полной информацией, но конструктивное его построение 
%- построение полного дерева игры, - 
часто является практически невозможным. 

\bigskip
Пример: шахматы, ...
\end{frame}

\begin{frame}{Поиск оптимальной стратегии}
Методы поиска оптимальной стратегии в заданной позиции (выбор хода) включают:
\begin{itemize}
\item полный перебор путей в дереве игры;
\item перебор с отсечением (альфа-бета процедура);
\item анализ нейронными сетями;
\item эвристические методы.
\end{itemize}
\end{frame}



%\subsection{Как думает человек}
%\input{sections/definitions_pr.tex}

%\AtBeginSubsection[]
%  {
%     \begin{frame}<beamer>
%     \frametitle{Содержание}
%     \tableofcontents[currentsubsection]
%     \end{frame}
%  }

%\subsection{Как играют современные программы}
%\input{sections/review_pr.tex}

%\subsection{Сравнение}
%\input{sections/statement_pr.tex}

\AtBeginSection[]
  {
     \begin{frame}<beamer>
     \frametitle{Содержание}
     \tableofcontents[currentsection]
     \end{frame}
  }
  
%\subsection{Метод М.М. Ботвинника}
%\input{sections/method_pr.tex}
\begin{frame}{Метод М.М. Ботвинника: понятие цепочки}
\centering
\begin{tabular}{l}
  {\hspace{-0.3cm}\scalebox{0.6}{\showDiagram{Ka1, Pa5, Na7, kh8, bh3}{}}}
  \hfill%
  \begin{tikzpicture}[scale=0.56]
    \begin{scope}[every node/.style={fill=white,circle,thick,draw,inner sep=0.5pt,font={\fontsize{7.20}{7.44}\selectfont}}]
      \node [label=above:{\setboardfontsize{0.4cm}{\textcolor{black}{\WhitePawnOnWhite}}}] (A5) at (0,0) {a5};
      \node (A6) at (2,0) {a6};
      \node (A7) at (4,0) {a7};
      \node (A8) at (6,0) {a8};
      \node [label=left:{\setboardfontsize{0.4cm}{\textcolor{black}{\WhiteKnightOnWhite}}}] (NA7) at (1,2.5) {a7};
      \node (B5) at (4,2.5) {b5};
      \node (C6) at (3,1.5) {c6};
      \node (C7) at (7,2.5) {c7};
      \node (C8) at (1.5,1.3) {c8};
      \node [label={45:{\setboardfontsize{0.4cm}{\textcolor{black}{\BlackBishopOnWhite}}}}] (H3) at (3,-3) {h3};
      \node (G2) at (6,-3) {g2};
      \node (F1) at (0.5,-1.7) {f1};
      \node (BC8) at (1.8,-1.7) {c8};
    \end{scope}

    \begin{scope}[>={stealth},
      % every node/.style={fill=white,circle},
      every edge/.style={draw=red,very thick}]
      % подцепочка 0
      \path [->] (A5) edge node [text width=0.5cm,midway,above] {} (A6); %  {B} 
      \path [->] (A6) edge (A7);
      \path [->] (A7) edge (A8);
      % Защита
      \path [->] (H3) edge[draw=black] (G2);
      \path [->] (G2) edge[gray, draw=gray, dashed] (A8);
      \path [->] (H3) edge[draw=black] (F1);
      \path [->] (F1) edge[gray, draw=gray, dashed] (A6);
      \path [->] (H3) edge[draw=black] (BC8);
      \path [->] (BC8) edge[gray, draw=gray, dashed] (A6);

      % Отступление 
      \path [->] (NA7) edge[draw=black] (B5);
      \path [->] (NA7) edge[draw=black] (C6);
      \path [->] (NA7) edge[draw=black] (C8);
      \path [->] (B5) edge[draw=black] (C7);
      \path [->] (B5) edge[gray, draw=gray, dashed] node [rotate=-90,above,yshift=0.15cm] {\textcolor{black}{$\stackrel{\text{\tiny подцепочка}}{\text{\tiny к полю}}$}} (A7);
      \path [->] (C7) edge[gray, draw=gray, dashed, bend left] (G2);
      \path [->] (C7) edge[gray, draw=gray, dotted] node [rotate=67,above,yshift=0.1cm] {\textcolor{black}{\tiny контроль}} (A8);
      % \path [->] (B) edge[bend right=60] node {$1$} (E); 
      \path [->] (C6) edge[draw=black, opacity=0.3, dotted, bend right] node [rotate=0,above,yshift=0.1cm] {\textcolor{black}{\tiny блокада g2-a8}} (G2);
    \end{scope}
  \end{tikzpicture}
\end{tabular}

Цепочка порождается последовательностью ходов (траекторией движения фигуры), а так же вспомогательными действиями, связанными с некоторыми
полями основной траектории. Каждая цепочка описывает возможное развитие игры в
случае выбора игроком данной цели.
\end{frame}


\begin{frame}
\frametitle{\only<1,3>{Pro et contra}
			\only<2>{Когнитивные процессы}}
\only<1,3>{
Преимущества подхода:
\begin{itemize}
\item строится план, а не один ход;
\item может использоваться для решения не только шахматных задач;
%, например, планирования.
\item соответствует особенностям мышления человека.
\end{itemize}
}

\only<2>{
%В данной работе ставится задача моделирования 
%Процесс поиска оптимальной стратегии, согласуется с данными психологических исследований шахматистов (де~Гроот, Саймон и др.), согласно которым шахматистам свойственно:
Психологические исследования шахматистов (де~Гроот, Саймон и др.) выявили следующие особенности мышления:
\begin{itemize}
\item восприятие позиции группами логически связанных фигур;
\item ограниченный перебор ($\approx 50-70$ позиций);
\item прогрессивное углубление;
\item долгосрочное планирование;
\item использование аналогий (типовые позиции).
\end{itemize} 
}

\only<3>{
Почему не было реализовано:
\begin{itemize}
\item недостаточные вычислительные мощности; %мегабайты памяти на тысячи цепочек.
\item отсутствие строгой формализации задачи;
\item \alert{сложнее}, чем построение дерева игры;
\item снижение интереса к задаче моделирования шахматиста, в связи с превосходством переборных алгоритмов над человеком.
\end{itemize}}
%При построении дерева достаточно иметь функцию оценки позиции и использовать минимакс. 
%Метод Ботвинника существенно сложнее, чем построение дерева игры.
\end{frame}


%здесь начинается своё
\section{Поиск неподвижной точки}

%Что хотим найти
\begin{frame}{Оптимальное представление позиции}
%Как неподвижная точка...
Представление позиции~--- набор цепочек, т.е. цели и способы их достижения, на котором задана функция оценки.

\smallskip
\smallskip
Рассмотрим граф представлений.

\begin{wrapfigure}[6]{l}{0.56\linewidth} 
%\center
\vspace{-3ex}
\includegraphics[width=0.56\textwidth]{graph_example}
%\caption{Схема графа представлений.}
\end{wrapfigure}

Дуги отражают изменения поднаборов цепочек определенного цвета, улучшающие оценку с точки зрения соответствующего игрока.

\smallskip
\smallskip
Неподвижная точка --- оптимальное представление позиции ~---
это набор цепочек, изменение которого невыгодно ни
одной из сторон.

%Перебор не ходов, а <<планов>>.
\end{frame}

%Почему сложно
\begin{frame}{Трудности реализации метода}
%Заметим, что оценка цепочки зависит от стоимости фигур, которые участвуют при реализации данной цепочки. В то же время стоимость фигуры зависит от оценки цепочек, в которых она задействована. Изменение стоимости фигуры может повлечь за собой изменение структуры цепочек или даже их исчезновение.

%Проблемы с примерами:
Выделим несколько основных сложностей, возникающих при решении задачи построения оптимального представления позиции.
\begin{enumerate}
\item Большое количество цепочек и подцепочек.
% --- процедура доопределения. 
% 2^6 для белого короля из этюда Рети
\item Связи между различными цепочками (завлечение, двойной удар, отвлечение).
%(дерево фигур), ищем вилочность.

\item Нельзя ограничить глубину построения цепочек (время успевания).
%этюд Рети

\item Зависимость между оценкой фигуры и оценкой цепочки или представлением позиции. 
%(Пример пропадающих или изменяющих структуру цепочек).

%4. траектории нулевой длины и область допустимого перемещения


%6. позиционно фигура может стоить меньше, чем базовая стоимость.

%7. выделение перспективных цепочек в представление на след. итерации (шах и мат?), изменение оценки при доопределении (может только уменьшиться)

%8. оценка таргетов, на который можно напасть множеством способов ?

\end{enumerate}
\end{frame}


\begin{frame}
\frametitle{\only<1> {Этюд Р.~Рети (1921): взаимосвязь цепочек}}
\begin{columns}
\column{0.5\textwidth}
\vspace{-5ex}
\begin{figure}[t]
  %\only<1,3,5>{\scalebox{0.8}{\showDiagram{Kh8, Pc6, ka6, ph5}{}}}
  %\only<2>{\scalebox{0.8}{\showDiagram{Kh8, Pc7, ka6, ph5}{a6-b7}}}
  %\only<4>{\scalebox{0.8}{\showDiagram{Kh7, Pc6, ka6, ph5}{h5-h4}}}
  %\only<6>{\scalebox{0.8}{\showDiagram{Ke7, Pc6, ka6, ph5}{}}}
  %\only<7>{\scalebox{0.8}{\showDiagram{Ke7, Pc7, ka6, ph5}{}}}
  %\only<8>{\scalebox{0.8}{\showDiagram{Ke7, Pc7, kb7, ph5}{}}}
  %\only<9>{\scalebox{0.8}{\showDiagram{Kd7, Pc7, kb7, ph5}{}}}
  \only<1>{\scalebox{0.8}{\showDiagram{Kh8, Pc6, ka6, ph5}{h8-e5, f6-e7, e5-d6, e5-h2}}}
\end{figure}
%\only<1-9>{Ход белых. Ничья.}
\column{0.5\textwidth}
%\only<2>{Провести свою пешку в ферзи не удаётся, так как король черных её легко догоняет.}
%\only<4>{Догнать чёрную пешку не получается. Она убегает.}
%\only<5>{Что же тогда делать?}
%\only<6-9>{Если король белых был бы на поле e7, то можно было бы пойти \alert<7>{1. c7} \alert<8>{Kb7} \alert<9>{2. Kd7} и 3. c8Q}
\only<1>{{Решение получаем объединением двух идей (двух цепочек).\\
 \smallskip Первая~--- Крh8-g7-f6-e7 (подцепочка-1 для c6-c7-c8Ф).\\
\smallskip Вторая~--- Крh8-g7-f6-e5-f4-g3-h2 (<<защитная>> подцепочка-1 для h5-h4-h3-h2-h1Ф)}}
\end{columns}
\only<1>{Траекторий h8-h2 --- $2^5$. \\
Наличие общей части позволяет выиграть необходимое время.}
\end{frame}

%Как хотим делать 
\begin{frame}{Метод поиска неподвижной точки}
%Найти оптимальное представление позиции методом перебора всех вариантов представлений практически невозможно, поэтому предлагается использовать итерационный алгоритм поиска приближения $\Gamma^*$.
\begin{enumerate}
\item Строим все \emph{полные цепочки}. % на статической доске
\item Составляем \emph{деревья фигур}, содержащие все их траектории и цепочки. Дерево фигуры позволяет выявить траектории движения фигуры, общие для нескольких цепочек.
\item Оцениваем каждую вершину дерева фигуры: изменение положения фигуры может сделать возможным или невозможным ее участие в некоторых цепочках.
\item Выделяем наиболее быстрые и выгодные цепочки, и доопределяем их, выбирая подцепочки, <<оптимальные>> согласно деревьям фигур. Обозначим полученный набор $\Gamma$.
\item Строим граф представлений исходящий из вершины $\Gamma$.
\item Методом минимакса на графах находим $\Gamma^*$.
%\item Переоцениваем фигуры и ищем приближение $\Gamma^*$ как \emph{неподвижную точку} в оценке цепочка-фигура.
\end{enumerate}
\end{frame}

%\begin{frame}{Упрощения задачи}

%Представление позиции строится при статичном положении фигур, поэтому далее необходимо выбрать по $\Gamma^*$ ходы-кандидаты и проверить их перебором на виртуальной доске.

%Рассматривается статическая доска, целевые фигуры не ходят (будет потом), пока горизонт статический (зависит от ситуации на доске, этапа игры и рассматриваемой фигуры), не ищем шах и мат?
%не решаем задачу поиска первого хода в позиции.
%\end{frame}

%\subsection{Понятие оптимальности}
%\input{sections/results_pr.tex}

\section{Заключение}
\begin{frame}{Результаты и перспективы}
На данный момент:


В будущем планируется:


\end{frame}

\begin{frame}{Формальная модель}

\emph{Траекторией} фигуры назовем упорядоченный набор полей ${T} \in \left( {S} \times {ST} \right)^+$, где
${S} = \{a1, b1, \dots, h8\}$ множество \emph{полей} доски, а
${ST} = \{stop, internal\}$~-- тип поля.

\emph{Цепочкой} $ch\in{}\mathtt{Chains}$ назовем набор $\langle color, traj, sch \rangle$,  где $color \in {C}=\{black, white\}$~--  цвет цепочки, $traj \in {T}$~-- траектория подцепочки-0, $sch \colon \mathbb{N}_0 \to 2^{\mathtt{Chains}}$~-- множество вспомогательных действий (подцепочек), связанных с полями траектории.  
Цепочка называется \emph{полной}, если она содержит все возможные
подцепочки (до заданного горизонта и глубины подцепочек), и
\emph{корректной}, если траектории каждой её фигуры попарно согласованы.

\emph{Представление позиции} есть множество корректных цепочек. %:  $Position \subseteq 2^{\mathtt{Chains}}$.
\end{frame}

\begin{frame}{Формальная модель}
Основные оценочные функции:
\begin{itemize}
\item \emph{стоимость фигуры} (в представлении позиции $p$) $\nu_{p}:{S} \to \mathbb{R}$;

\item \emph{стоимость цепочки} $\varphi \colon \mathtt{Chains} \to \mathbb{R}$, например,
$$
 \varphi \left( ch \right) = \sum\limits_{k=0}^{|traj(ch)|} \left(  \sum_{ p \in ep\left(k\right)} \nu\left(p\right) + \sum_{c \in sch\left(k\right)} \varphi\left(c\right) \right),
$$
$ep\left(k\right)$~-- набор фигур, участвующих в размене на поле $k$; 
\item \textit{время успевания} цепочки $ch$ до $k$-ого поля основной траектории $\tau \colon  \mathtt{Chains}\times\mathbb{N}_0 \to \mathbb{N}_{0} $;
%% Нужно исключить размены, так как они не прибавляют времени
% \alert{
% $$
% \tau_{ch}\left( k\right) = |T| + \sum_{n<len}\sum_{c \in sch\left(n\right)} \tau\left(c\right) - ... \text{, где } T = \{ t \in traj\left[1\colon k\right]|_{stop} \}
% $$}

\item оценка \textit{локальной реализуемости} цепочки $\rho \colon \mathtt{Chains} \to \left[0,1\right]$. Цепочки с большим числом вариантов защиты или временем реализации менее <<опасны>>;

\item оценка \textit{позиции} $\Phi \colon \mathtt{Positions} \to \mathbb{R}$
зависит от числа цепочек, максимального значения оценочной функции $\varphi$ по цепочкам позиции и суммы значений этой функции.
\end{itemize}
\end{frame}

\begin{frame}{Формальная модель}
\textit{Графом представлений} назовем ориентированный раскрашенный граф, узлами которого являются представления позиции. Если две вершины
$\Gamma_{1}$ и $\Gamma_{2}$, совпадающие по множеству белых цепочек
таковы, что $\Phi(\Gamma_1) > \Phi(\Gamma_2)$, то проводится
ориентированная дуга из $\Gamma_1$ в $\Gamma_2$, а
концевая вершина окрашивается в белый цвет. Это означает, что черные могут
улучшить оценку позиции $\Gamma_1$ в свою пользу, изменив некоторые
свои действия, но решение о сохранении полученного результата
принимают белые. Аналогично для черного цвета.
Будем использовать символ $\prec_{c}$ для обозначения сравнения, учитывающего цвет.

{\bf Утверждение.}{\it~Если длина траекторий подцепочек-0 ограничена сверху, то граф представлений конечен.}
\end{frame}

\begin{frame}{Формальная модель}
Пусть $\alpha\in\mathbb{R}$. Вершину $\Gamma'$ назовем \emph{$\alpha$-достижимой из вершины} $\Gamma$ цвета $c$, если:
\begin{itemize}
\item $\Phi(\Gamma') \succcurlyeq_{c} \Phi(\Gamma)$;
\item найдется путь $\pi=\Gamma_0,\Gamma_1,\ldots,\Gamma_k$ ($k\geqslant 0)$ такой, что $\Gamma_0=\Gamma$ и $\Gamma_k=\Gamma'$;
\item для любой лежащей на пути $\pi$ вершины $\Gamma_i$ цвета $c_i$ ($i \geqslant 0$) выполняется условие 
$\Phi(\Gamma_i) \preccurlyeq_{c_i} \alpha$.
\end{itemize}
Вершину $\Gamma'$ назовем \emph{минимакс-достижимой из $\Gamma$}, если она $\Phi(\Gamma')$-достижима из $\Gamma$.
\end{frame}

\begin{frame}{Формальная модель}
Назовем вершину $\widehat{\Gamma}$ \textit{минимакс-оптимальной для вершины $\Gamma$}, если она минимакс-достижима из $\Gamma$ и любая другая минимакс-достижимая из $\Gamma$ вершина $\Gamma'$ цвета $c'$, для которой $\Phi(\Gamma') \succ_{c'} \Phi(\widehat{\Gamma})$, либо не является $\Phi(\widehat{\Gamma})$-достижимой из $\Gamma$, либо имеет минимакс-достижимую вершину $\Gamma''$, для которой $\Phi(\Gamma'') \prec_{c'} \Phi(\widehat{\Gamma})$.


{\bf Утверждение.}{\it~Для любой вершины любого конечного графа представлений существует минимакс-оптимальная вершина.}
% %Перебором можно найти

\emph{Оптимальным представлением позиции} назовем такую вершину $\Gamma^*$ графа представлений, что $\widehat{\Gamma^*}=\Gamma^*$ и  для любой вершины $\Gamma$ выполнено $\Phi(\widehat{\Gamma}) \preccurlyeq_c \Phi(\Gamma^*)$, где $c$~-- цвет $\widehat{\Gamma}$.

{\bf Теорема.}{\it~Существует алгоритм нахождения оптимального представления позиции.}
\end{frame}

\end{document}
